<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TextAreaFunc</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css">
    <script src="../util.js"></script>
</head>

<body>
    <script>
        const START_HEIGHT = `calc(${10}lh + .5rem + var(--bs-border-width) * 2)`;

        const countNewLines = s => s.match(/\n/g).length + 1;

        const _default = (input, output) => output(input
                .split(",")
                .sort(Sort.alpha(o => o))
                .join("\n")
            );
        
        const _func = _default.toString().split("\n");
        const _head = _func.slice(0, 1);
        const _body = _func.slice(1, -1);
        const _tail = _func.slice(-1);

        const apply = (e, n) => {
            try {
                Dom.NODES.func.classList.remove("is-invalid");
                Dom.NODES.func.classList.add("is-valid");
                eval(_head + Dom.NODES.func.value + _tail)(Dom.NODES.input.value, (out) => {Dom.NODES.output.innerText = out; });
            } catch (e) {
                Dom.NODES.func.classList.remove("is-valid");
                Dom.NODES.func.classList.add("is-invalid");
                Dom.NODES.output.innerText = e.message;
                console.log(e);
            }
        }

        const func = Textarea.with({
            id: "func",
            class: "form-control font-monospace form-control-sm",
            attribute: { spellcheck: false },
            value: _body.map(s => s.trim()).join("\n"),
            event: { input: apply },
            style: { height: START_HEIGHT }
        });
        const input = Textarea.with({
            id: "input",
            class: "form-control form-control-sm",
            event: { input: apply },
            style: { height: START_HEIGHT },
            attribute: { placeholder: "input" }
        });
        const output = Pre.with({
            id: "output",
            class: "lh-sm mt-3 form-control form-control-sm",
        });
        Dom.qs("body").append(Section.with({
            class: "container mt-2",
            attribute: { spellcheck: false },
            children: [
                H1.with({ innerText:"Textarea Func" }),
                Section.with({
                    class: "row",
                    children: [
                        Span.with({ class: "col-4", children: func }),
                        Span.with({ class: "col-8", children: input }),
                    ]
                }),
                output
            ]
        }).create());
    </script>
</body>

</html>
