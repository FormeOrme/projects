<html>

<head>
    <style>
        body {
            font-size: 0;
            margin: 0;
        }

        .hide {
            display: none !important;
        }
    </style>
</head>

<body>
    <div class="hide">
        <img id="org" src="org.jpg" />
        <img id="src" src="src.jpg" />
    </div>

    <div id="wrapper"></div>

    <canvas id="out"></canvas>
    <script>
    /* floor : ~~ */
    const checkImage = path =>
        new Promise(resolve => {
            const img = new Image();
            img.onload = () => resolve({ path, status: 'ok' });
            img.onerror = () => resolve({ path, status: 'error' });
            img.src = path;
        });
    const loadImg = (...paths) => Promise.all(paths.map(checkImage));
    

    const e = { w: 30, h: 50 };

    /* CUSTOM */
    const data = (/*image.canvas*/ i, /*index*/ j) =>
        i.c.ctx.d(...[
        /*sx*/
        /*sy*/ ...xy(j, i.c.w, e.w, e.h),
        /*sw*/ e.w,
        /*sh*/ e.h
        ]).data;

    const xy = (i, bw, w, h) => [
    /*x*/ w * (i % ~~(bw / w)),
    /*y*/ h * ~~(i / ~~(bw / w))
    ];

    loadImg("src.jpg", "org.jpg").then(() => {
        const o = org;
        o.w = o.width;
        o.h = o.height;
        const s = src;
        s.w = s.width;
        s.h = s.height;
        
        const co = document.createElement("canvas");
        co.w = co.width  = e.w*~~(o.w/e.w);
        co.h = co.height = e.h*~~(o.h/e.h);
        var ctx = co.getContext("2d");
        co.ctx = ctx;
        ctx.d = ctx.getImageData;
        ctx.drawImage(o, ~~(o.w/e.w), ~~(o.h/e.h), co.w, co.h, 0, 0, co.w, co.h);
        org.canvas = org.c = co;
        wrapper.append(co);
        
        //ctx.drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);

        var nh = ~~Math.sqrt(  ( s.h*o.w*o.h )/s.w );
        var nw = ~~((s.w*nh)/s.h);

        const cs = document.createElement("canvas");
        cs.w = cs.width  = e.w*~~(nw/e.w);
        cs.h = cs.height = e.h*~~(nh/e.h);
        var ctx = cs.getContext("2d");
        cs.ctx = ctx;
        ctx.d = ctx.getImageData;
        ctx.drawImage(src, 0, 0);
        src.canvas = src.c = cs;
        wrapper.append(cs);

        /* SOURCE TILE SIZE */
        // const r = {}
        // r.h = Math.sqrt((e.h * e.h * s.w * s.h) / (o.w * o.h));
        // r.w = (e.w * r.h) / e.h;

        const p = {
            o: o,
            s: s,
            ctx: out.getContext("2d")
        };
        
        window.p = p;
    });

    </script>
</body>

</html>